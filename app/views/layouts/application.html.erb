<!DOCTYPE html>
<html>
<head>
  <title>Fashion Shop Map</title>
  <meta name="description" content="ã‚»ãƒ¬ã‚¯ãƒˆã‚·ãƒ§ãƒƒãƒ—ã‚’ä¸­å¿ƒã¨ã—ãŸãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³ã‚·ãƒ§ãƒƒãƒ—ã®åº—èˆ—æ¤œç´¢ã‚·ã‚¹ãƒ†ãƒ " />
  <meta name="author" content"@piyo56" />
  <meta property="og:title" content="Fashion Shop Map" />
  <meta property="og:type" content="article" />
  <meta property="og:image" content="http://assets/mylogo2.png" />
  <meta property="twitter:site" content="@piyo56_net" />
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <%= csrf_meta_tags %>
  <%= favicon_link_tag %>
    
  <!-- stylesheet files -->
  <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track' => true %>
  <% case params[:controller] %>
  <% when "shops" %>

    <% case params[:action] %>
    <% when "index" %>
      <%= stylesheet_link_tag "index", :media => "all" %>
    <% when "show" %>
      <%= stylesheet_link_tag "show", :media => "all" %>
    <% when "index", "show" %>
      <%= stylesheet_link_tag "choices", :media => "all" %>
    <% when "about" %>
      <%= stylesheet_link_tag "about", media: "all" %>
    <% end %>

  <% when "inquiry" %>
    <%= stylesheet_link_tag "inquiry", :media => "all" %>
  <% end %>

  <!-- javascript files -->
  <%= javascript_include_tag 'application', 'data-turbolinks-track' => true %>
  <!--[if lt IE 9]>
    <%= javascript_include_tag 'html5shiv' %>
  <![endif]-->
  <script async>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-86522604-1', 'auto');
    ga('send', 'pageview');
  </script>
</head>

<body>
<header>
  <a href="/"><span id="page_title">Fashion Shop Map</span></a>
  <a href="/inquiry">
    <button id="inquiry" type="button" class="btn btn-default">
      <span class="glyphicon glyphicon-envelope" aria-hidden="true"></span>
      <span id="inquiry_text">ãŠå•ã„åˆã‚ã›</span>
    </button>
  </a>
  <a href="/about">
    <button id="about" type="button" class="btn btn-default">
      <span class="glyphicon glyphicon-question-sign" aria-hidden="true"></span>
      <span id="about_text">å½“ã‚µã‚¤ãƒˆã«ã¤ã„ã¦</span>
    </button>
  </a>
</header>
<div class="clear"></div>

<main>
  <%= yield %>
</main>

<div class="clear"></div>
<footer>
  <% share_url   = "http://select-shop-map.herokuapp.com/" %>
  <% description = "[Fashion] ã‚»ãƒ¬ã‚¯ãƒˆã‚·ãƒ§ãƒƒãƒ—ã‚’ä¸­å¿ƒã¨ã—ãŸã‚·ãƒ§ãƒƒãƒ—ã®åº—èˆ—æ¤œç´¢ã‚·ã‚¹ãƒ†ãƒ " %>
  <div id="share_buttons">
  <% #{{{ %>
    <ul>
      <li>
        <% facebook_url = "https://www.facebook.com/sharer/sharer.php?u=" + share_url + "&t=" + URI.encode(description) %>
        <div class="sns_icon facebook"><a href='<%= facebook_url %>' target="_blank" title="Facebookã§ã‚·ã‚§ã‚¢"><img src="/assets/share/facebook.png" alt="facebook"></a></div>
      <li>
        <% twitter_url = "https://twitter.com/share?shareUrl=" + share_url + "&text=" + URI.encode(description+"ğŸ’¡") %>
        <div class="sns_icon twitter"><a href='<%= twitter_url %>' title="twitterã§ã‚·ã‚§ã‚¢"><img src="/assets/share/twitter.png" alt="twitter"></a></div>
      <li>
        <% google_url = "https://plus.google.com/share?url=" + share_url %>
        <div class="sns_icon google"><a href='<%= google_url %> ' target="_blank" title="Google+ã§å…±æœ‰"><img src="/assets/share/google.png" alt="googleplus"></a></div>
      <li>
        <% hatena_url = "https://b.hatena.ne.jp/add?mode=confirm&url=" + share_url + "&title=" + URI.encode(description)%>
        <div class="sns_icon hatena"><a href='<%= hatena_url %>' target="_blank" title="ã¯ã¦ãªãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã«ç™»éŒ²"><img src="/assets/share/hatena.png" alt="ã¯ã¦ãªãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯"></a></div>
      <li>
        <div class="sns_icon line"><a href='<%= "http://line.me/R/msg/text/?" + URI.encode(description + " " + share_url) %>' target="_blank" title="LINEã«é€ã‚‹"><img src="assets/share/line.png" alt="LINE"></a></div>
    </ul>
    <% #}}} %>
  </div>
  <p>Copyright Â© 2016 &nbsp; <a href="http://hoodie.tokyo" target="_blank" style="text-decoration: underline; font-weight: bold;">@piyo56</a> All Rights Reserved.</p>
</footer>
<div class="clear"></div>

<!-- javascript files -->
<% case params[:controller] %>
<% when "shops" %>

  <% case params[:action] %>
  <% when "show" %>
    <script src="http://maps.googleapis.com/maps/api/js?key=AIzaSyCgc17y7bu5UP0-jeDqY4zwbPh0sySSsMs&libraries=places"></script>
    <% #<script src="http://maps.googleapis.com/maps/api/js?key=AIzaSyAKSmtc7T8T72MMS0G&#45;MEflbNk_p8TmrtQ&#38;libraries=places" defer></script> %>
    <%= javascript_include_tag 'infobox_packed', 'data-turbolinks-track' => true %>
    <%= javascript_include_tag 'markerclusterer.min', 'data-turbolinks-track' => true %>
    <script>
    <% #{{{ %>
      var handler = Gmaps.build('Google');
      var markers;

      handler.buildMap({ internal: {id: 'map'}}, function(){
        markers = handler.addMarkers(<%=raw @branch_markers.to_json %>);
        handler.bounds.extendWith(markers);
        handler.fitMapToBounds();
      });

      var input = document.getElementById('pac-input');
      var searchBox = new google.maps.places.SearchBox(input);
      var map = handler.getMap();

      // åº—èˆ—ãƒªã‚¹ãƒˆ
      var previous_clicked_div;
      $(".branch").on("click", function(){
        // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸdivã¯èƒŒæ™¯è‰²å¤‰æ›´ã‚’å¤‰æ›´ã—ã¦hoverå±æ€§ã‚’unbind
        $(this).css('background', '#cacce2');
        $(this).unbind("mouseenter").unbind("mouseleave");

        // æœ€åˆã®ã‚¯ãƒªãƒƒã‚¯ã§ãªãã€ã‹ã¤ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸdivãŒå‰å›ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã‚‚ã®ã¨ç•°ãªã‚‹å ´åˆ
        if(previous_clicked_div !== undefined && previous_clicked_div.attr("id") != $(this).attr("id")){
          // backgroundã¨hoverå±æ€§ã‚’ã‚‚ã¨ã«æˆ»ã—ã¦ã‚ã’ã‚‹
          previous_clicked_div.css('background', '#f2f4f6');
          previous_clicked_div.bind("mouseenter",function(){
            $(this).css('background', '#dee0e2');
          });
          previous_clicked_div.bind("mouseleave",function(){
            $(this).css('background', '#f2f4f6');
          });
        }
        previous_clicked_div = $(this);

        // åœ°å›³ã®ä¸­å¿ƒã‚’ãã®åº—èˆ—ã«åˆã‚ã›ã‚‹
        var lat = parseFloat($(this).find(".lat").text());
        var lng = parseFloat($(this).find(".lng").text());
        var id  = parseInt($(this).attr("id"));
        map.panTo(new google.maps.LatLng(lat, lng));
        google.maps.event.trigger(markers[id].serviceObject, "click");
        map.setZoom(15);
      });

      // æ¤œç´¢æ™‚ã®å‡¦ç†
      var old_marker;
      searchBox.addListener('places_changed', function() {
        var places = searchBox.getPlaces();
        if (places.slength == 0) {
          return;
        }
        var place = places[0]
        old_marker = place;

        // Create a marker for each place.
        handler.addMarker({
          map:   map,
          title: place.name,
          lat:   place.geometry.location.lat(),
          lng:   place.geometry.location.lng()
        });

        var bounds = new google.maps.LatLngBounds();
        if (place.geometry.viewport) {
          // Only geocodes have viewport.
          bounds.union(place.geometry.viewport);
          map.fitBounds(bounds);
        } else {
          bounds.extend(place.geometry.location);
          map.fitBounds(bounds);
          map.setZoom(15);
        }
      });
    <% #}}} %>
    </script>
  <% when "index", "show" %>
    <%= javascript_include_tag 'choices' %>
  <% end %>

<% end %>
<%= javascript_include_tag 'share_buttons'%>
</body>
</html>
